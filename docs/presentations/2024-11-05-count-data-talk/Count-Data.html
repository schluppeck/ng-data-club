<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Leonardo Cohen">
<meta name="dcterms.date" content="2024-11-04">

<title>Dealing with Count Data – NG data club</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-07ba0ad10f5680c660e360ac31d2f3b6.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-55859fa54c801d31e22b4dc9de319c22.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">NG data club</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../presentations/index.html"> 
<span class="menu-text">Presentations</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#preamble" id="toc-preamble" class="nav-link active" data-scroll-target="#preamble">Preamble</a></li>
  <li><a href="#count-data" id="toc-count-data" class="nav-link" data-scroll-target="#count-data">Count data</a>
  <ul class="collapse">
  <li><a href="#binomial" id="toc-binomial" class="nav-link" data-scroll-target="#binomial">Binomial</a></li>
  <li><a href="#poisson" id="toc-poisson" class="nav-link" data-scroll-target="#poisson">Poisson</a></li>
  <li><a href="#negative-binomial" id="toc-negative-binomial" class="nav-link" data-scroll-target="#negative-binomial">Negative Binomial</a></li>
  </ul></li>
  <li><a href="#example-stock-trading" id="toc-example-stock-trading" class="nav-link" data-scroll-target="#example-stock-trading">Example: Stock trading</a>
  <ul class="collapse">
  <li><a href="#transformations" id="toc-transformations" class="nav-link" data-scroll-target="#transformations">Transformations</a></li>
  <li><a href="#ordinary-linear-regression-applied-to-count-data" id="toc-ordinary-linear-regression-applied-to-count-data" class="nav-link" data-scroll-target="#ordinary-linear-regression-applied-to-count-data">Ordinary linear regression applied to count data</a>
  <ul class="collapse">
  <li><a href="#assumptions" id="toc-assumptions" class="nav-link" data-scroll-target="#assumptions">Assumptions</a></li>
  <li><a href="#transformation-log" id="toc-transformation-log" class="nav-link" data-scroll-target="#transformation-log">Transformation (log)</a></li>
  </ul></li>
  <li><a href="#count-distributions-poisson-and-negative-binomial" id="toc-count-distributions-poisson-and-negative-binomial" class="nav-link" data-scroll-target="#count-distributions-poisson-and-negative-binomial">Count distributions: Poisson and Negative Binomial</a></li>
  <li><a href="#negative-binomial-model" id="toc-negative-binomial-model" class="nav-link" data-scroll-target="#negative-binomial-model">Negative Binomial model</a></li>
  </ul></li>
  <li><a href="#repeated-measures-mixed-effects-example" id="toc-repeated-measures-mixed-effects-example" class="nav-link" data-scroll-target="#repeated-measures-mixed-effects-example">Repeated-measures (Mixed effects) Example</a></li>
  <li><a href="#zero-inflation" id="toc-zero-inflation" class="nav-link" data-scroll-target="#zero-inflation">Zero inflation</a>
  <ul class="collapse">
  <li><a href="#testing-for-zero-inflation" id="toc-testing-for-zero-inflation" class="nav-link" data-scroll-target="#testing-for-zero-inflation">Testing for zero-inflation</a>
  <ul class="collapse">
  <li><a href="#fit-a-zero-inflated-distribution" id="toc-fit-a-zero-inflated-distribution" class="nav-link" data-scroll-target="#fit-a-zero-inflated-distribution">Fit a zero-inflated distribution</a></li>
  <li><a href="#run-a-negative-binomial-and-test-for-zero-inflation" id="toc-run-a-negative-binomial-and-test-for-zero-inflation" class="nav-link" data-scroll-target="#run-a-negative-binomial-and-test-for-zero-inflation">Run a negative binomial and test for zero inflation</a></li>
  <li><a href="#compare-a-negative-binomial-model-with-a-zero-inflated-model" id="toc-compare-a-negative-binomial-model-with-a-zero-inflated-model" class="nav-link" data-scroll-target="#compare-a-negative-binomial-model-with-a-zero-inflated-model">Compare a negative binomial model with a zero-inflated model</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#postscript-dont-like-to-use-r" id="toc-postscript-dont-like-to-use-r" class="nav-link" data-scroll-target="#postscript-dont-like-to-use-r">Postscript: Don’t like to use R?</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">Further reading</a></li>
  <li><a href="#other-similar-types-of-data" id="toc-other-similar-types-of-data" class="nav-link" data-scroll-target="#other-similar-types-of-data">Other (similar) types of data</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Dealing with Count Data</h1>
<p class="subtitle lead">NG Data Club</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Leonardo Cohen </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2024-11-04</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<style>
div.blue {background-color:#e6f0ff; border-radius: 5px; padding: 20px; margin: 20px}
</style>
<section id="preamble" class="level1">
<h1>Preamble</h1>
<p>We start by loading the necessary packages and the .RData for these examples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data, make sure the directory is the correct one</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">'Count_datasets.RData'</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># for running the different type of regressions</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pscl)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># for fitting distributions to your data</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fitdistrplus)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># for calculating marginal means from model outputs</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># for checking model diagnostics</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DHARMa)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># for displaying the results neatly</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># for changing databases between long and wide</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="count-data" class="level1">
<h1>Count data</h1>
<div class="blue">
<p>So you captured some data and it looks like these example datasets below.</p>
</div>
<p>These three datasets are from gambling experiments, where participants were given some money and allowed to place as many bets as they wanted in a simulated roulette or football fixtures. They did not have to bet if they did not want to, and could simply keep the money given to them. Those that decided to bet were paid the outcomes of their bets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histogram for example 1</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(example_data_1, <span class="fu">aes</span>(<span class="at">x =</span> bet_count)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">binwidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">'N participants'</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Number of bets placed in roulette experiment 1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/load examples-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histogram for example 2</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(example_data_2, <span class="fu">aes</span>(<span class="at">x =</span> bet_count)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">binwidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">'N participants'</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Number of bets placed in roulette experiment 2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/load examples-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histogram for example 3</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(example_data_3, <span class="fu">aes</span>(<span class="at">x =</span> bet_count)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">binwidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">'N participants'</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">'Number of bets placed in football fixtures'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/load examples-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="blue">
<p>This is all <strong>count data</strong>. Count data can be characterized as:</p>
<ul>
<li>Discrete (integers) data: 0, 1, 2, 3, …</li>
<li>They count something, such as people, instances, events, actions, successes, or occurrences.</li>
<li>Cannot be smaller than zero (lower bound = 0) but do not have an upper limit.</li>
</ul>
</div>
<p>There are many distributions used for count data, such as Binomial, Poisson, and Negative Binomial.</p>
<section id="binomial" class="level2">
<h2 class="anchored" data-anchor-id="binomial">Binomial</h2>
<p>For example, there is the binomial distribution, and its special case, Bernoulli, which is used for binary logistic regression. The general binomial distribution has two parameters, <em>N</em> the number of trials, and <em>p</em> the probability of success at each trial. The mean is <em>N <span class="math inline">\(\times\)</span> p</em>.</p>
<p>Below you can see some plots of different binomial distributions. They don’t seem too similar to our datasets from above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Ns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>) <span class="co"># set some example for Ns</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>) <span class="co"># set some examples for probabilities</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>Nprobs <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">N=</span>Ns, <span class="at">Prob=</span>probs) <span class="co"># creates a matrix of all the Ns x all the probabilities</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the point density of the binomial distribution with the Ns and Ps from above</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>sim_binomial <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">apply</span>(Nprobs, <span class="dv">1</span>, <span class="cf">function</span>(np) <span class="fu">data.frame</span>(<span class="at">N=</span>np[[<span class="dv">1</span>]], <span class="at">Prob=</span>np[[<span class="dv">2</span>]], <span class="at">Count=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>, <span class="at">Frequency=</span><span class="fu">dbinom</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>,<span class="at">size=</span>np[<span class="dv">1</span>], <span class="at">prob=</span>np[<span class="dv">2</span>]))))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>sim_binomial<span class="sc">$</span>N <span class="ot">&lt;-</span> <span class="fu">factor</span>(sim_binomial<span class="sc">$</span>N) <span class="co"># transform into factor for the legend</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>sim_binomial<span class="sc">$</span>Prob <span class="ot">&lt;-</span> <span class="fu">factor</span>(sim_binomial<span class="sc">$</span>Prob) <span class="co"># transform into factor for the legend</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histograms</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_binomial, <span class="fu">aes</span>(<span class="at">x=</span>Count<span class="fl">+0.5</span>, <span class="at">y =</span> Frequency, <span class="at">color=</span>N, <span class="at">group=</span>N, <span class="at">fill=</span>N)) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">geom =</span> <span class="st">'area'</span>, <span class="at">method =</span> <span class="st">'loess'</span>, <span class="at">span =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>Prob, <span class="at">labeller =</span> label_both) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/typical binomial-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="poisson" class="level2">
<h2 class="anchored" data-anchor-id="poisson">Poisson</h2>
<p>The <strong>Poisson</strong> distribution is probably the most famous of the count distributions. It only has one parameter, <em>lambda</em>, which is the expected mean (and also its standard deviation). It is often used to model the number of people in a queue at any point in time, number of people who attend a class, or the number of daily customers that visit a store.</p>
<p>Below you can see some plots of different Poisson distributions. These are more similar to our datasets, in particular with small lambdas, but with only one parameter they are not very flexible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">12</span>) <span class="co"># set some example for lambdas</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the point density of the poisson distribution with the lambdas from above</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>sim_poisson <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(lambdas, <span class="cf">function</span>(l) <span class="fu">data.frame</span>(<span class="at">Lambda=</span>l, <span class="at">Count=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>, <span class="at">Frequency=</span><span class="fu">dpois</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>,l))))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>sim_poisson<span class="sc">$</span>Lambda <span class="ot">&lt;-</span> <span class="fu">factor</span>(sim_poisson<span class="sc">$</span>Lambda)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histograms</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_poisson, <span class="fu">aes</span>(<span class="at">x=</span>Count<span class="fl">+0.5</span>, <span class="at">y =</span> Frequency, <span class="at">color=</span>Lambda, <span class="at">group=</span>Lambda, <span class="at">fill=</span>Lambda)) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">geom =</span> <span class="st">'area'</span>, <span class="at">method =</span> <span class="st">'loess'</span>, <span class="at">span =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/typical Poisson-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="negative-binomial" class="level2">
<h2 class="anchored" data-anchor-id="negative-binomial">Negative Binomial</h2>
<p>Another one is the <strong>Negative Binomial</strong> distribution, which is more flexible than Poisson with two parameters, <em>mu</em>, which is the expected mean, and <em>size</em> which is a measure of dispersion (similar to deviation).</p>
<p>Below you can see some plots of different Negative Binomial distributions. These are the most similar to our distributions.</p>
<div class="blue">
<p>Negative Binomial is probably the most useful distribution for psychological experimental data.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mus <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">12</span>) <span class="co"># set some example for mus</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">12</span>) <span class="co"># set some example for sizes</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>musizes <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">mu=</span>mus, <span class="at">size=</span>sizes) <span class="co"># creates a matrix of all the mus x all the sizes</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the point density of the negative binomial distribution with the mus and sizes from above</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>sim_nbinom <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">apply</span>(musizes, <span class="dv">1</span>, <span class="cf">function</span>(ms) <span class="fu">data.frame</span>(<span class="at">Mu=</span>ms[[<span class="dv">1</span>]], <span class="at">Size=</span>ms[[<span class="dv">2</span>]], <span class="at">Count=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">Frequency=</span><span class="fu">dnbinom</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>,<span class="at">size=</span>ms[[<span class="dv">2</span>]], <span class="at">mu=</span>ms[[<span class="dv">1</span>]]))))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>sim_nbinom<span class="sc">$</span>Mu <span class="ot">&lt;-</span> <span class="fu">factor</span>(sim_nbinom<span class="sc">$</span>Mu) <span class="co"># transform into factor for the legend</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>sim_nbinom<span class="sc">$</span>Size <span class="ot">&lt;-</span> <span class="fu">factor</span>(sim_nbinom<span class="sc">$</span>Size) <span class="co"># transform into factor for the legend</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histograms</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_nbinom, <span class="fu">aes</span>(<span class="at">x=</span>Count<span class="fl">+0.5</span>, <span class="at">y =</span> Frequency, <span class="at">color=</span>Mu, <span class="at">group=</span>Mu, <span class="at">fill=</span>Mu)) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>)) <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">geom =</span> <span class="st">'area'</span>, <span class="at">method =</span> <span class="st">'loess'</span>, <span class="at">span =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>Size, <span class="at">labeller =</span> label_both) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/typical negative binomial-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="example-stock-trading" class="level1">
<h1>Example: Stock trading</h1>
<p>Let’s look at one particular example: <code>trade_data</code>. This study was about stock trading behaviour, and participants were allowed to trade stocks (buy or sell) as they wanted in a simulated trading task.</p>
<div class="blue">
<p>Crucially, the data <strong>counts</strong> how many trades participants made during the task. Participants did not <strong>need</strong> to trade at all, so the minimum number of trades was zero. There was <strong>no upper limit</strong>, participants could make as many trades as they wanted.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show histogram of trade_count</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trade_data, <span class="fu">aes</span>(<span class="at">x =</span> trade_count)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">binwidth=</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Number of trades made (buy + sell combined)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade data histogram-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see the range and quantiles of trades in the table below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quantiles of trades made</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">quantile</span>(trade_data<span class="sc">$</span>trade_count), <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"quantile"</span>, <span class="st">"trade count"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">quantile</th>
<th style="text-align: right;">trade count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0%</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">25%</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">50%</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">75%</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">100%</td>
<td style="text-align: right;">68</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>R has a handy function that checks how well a distribution fits against a set distribution, <code>fitdist</code> from package <code>fitdistrplus</code>. It estimates the best fit parameters that most closely fits the data. In the case of a normal distribution, it estimates the mean and standard deviation (sd).</p>
<p>Let’s see how well this fits a normal distribution. Ideally the data should be <strong>as close as possible</strong> to the theoretical best fit distribution (shown in red). As expected, it’s a <strong>very poor fit</strong>. We have excess observations in both ends of the distribution.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare trade_count data with a normal distribution</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 'Summary' shows the best fitting mean and sd of a normal distribution against this data, and the loglikelihood measures the deviance between the actual data and the best fitting distribution.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">fitdist</span>(trade_data<span class="sc">$</span>trade_count, <span class="at">dist=</span><span class="st">"norm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting of the distribution ' norm ' by maximum likelihood 
Parameters : 
     estimate Std. Error
mean 12.82886  0.4506794
sd   11.00248  0.3186784
Loglikelihood:  -2274.967   AIC:  4553.935   BIC:  4562.715 
Correlation matrix:
             mean           sd
mean 1.000000e+00 6.857721e-07
sd   6.857721e-07 1.000000e+00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 'Plot' is used to create the plot shown below.</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitdist</span>(trade_data<span class="sc">$</span>trade_count, <span class="at">dist=</span><span class="st">"norm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade fitdistr normal-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="transformations" class="level2">
<h2 class="anchored" data-anchor-id="transformations">Transformations</h2>
<p>Because the data seems skewed, you might be tempted to analyse its log. However, because this is discrete count data, transforming it will not fix the problem. If you log the data, it will be closer to, but still not exactly, a normal distribution. Transformations tend to work better with continuous data.</p>
<div class="blue">
<p>There’s an additional problem that count data often contains <strong>zeros</strong>, and the log of zero is undefined. So if we want to try the log of this data, we need to add +1 (or any other positive amount) before calculating the log.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log trade_count + 1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trade_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">log</span>(trade_count<span class="sc">+</span><span class="dv">1</span>))) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">binwidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade logged data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The log of the trade count data + 1 is closer to a normal distribution, but still problematic - there is still an excess of observations at the lower end, and missing observations below zero.</p>
<div class="blue">
<p>This is because normal distributions assume that the data is unbounded (with no lower or upper limits) but in this case the raw data has a lower bound of zero, as you cannot have any <strong>counts below zero</strong>.</p>
<p>Another problem is that Normal distributions assume that the data is continuous, and in this case the raw data is <strong>discrete</strong> (only integers are allowed: 1, 2, 3, etc).</p>
<p>The fit of the normal distribution here is not <em>too</em> bad, but it would much worse when there are <strong>extreme (very large) values</strong> - very high counts - which can be very common in count data. Normal distributions struggle with large values, which will skew analysis and interpretation. Count distribution will handle extreme outliers much better.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare log of trade_count + 1 data with a normal distribution</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitdist</span>(<span class="fu">log</span>(trade_data<span class="sc">$</span>trade_count<span class="sc">+</span><span class="dv">1</span>), <span class="at">dist=</span><span class="st">"norm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade fitdistr log normal-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Adding +1 is also completely subjective and <strong>arbitrary</strong>, we could arguably add +0.1 or +10. The results are quite different and it also changes how well the new log data fits a theoretical normal distribution, and will impact the results and interpretation of any analysis we might run on this data. And no matter what we do, we always have a problem with the excess observations at the lower end.</p>
<div class="blue">
<p>Unless you are pre-registering how much you will add before the log (and have a good theoretical reason for this), this transformation can easily lead to p-hacking.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># testing other logs</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitdist</span>(<span class="fu">log</span>(trade_data<span class="sc">$</span>trade_count<span class="fl">+.1</span>), <span class="at">dist=</span><span class="st">"norm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade fitdistr log normal plus-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitdist</span>(<span class="fu">log</span>(trade_data<span class="sc">$</span>trade_count<span class="sc">+</span><span class="dv">10</span>), <span class="at">dist=</span><span class="st">"norm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade fitdistr log normal plus-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Therefore we should never log count data when it’s this close to zero.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
</section>
<section id="ordinary-linear-regression-applied-to-count-data" class="level2">
<h2 class="anchored" data-anchor-id="ordinary-linear-regression-applied-to-count-data">Ordinary linear regression applied to count data</h2>
<p>We could try to analyse this trade count data (<em>the raw data, not the log</em>) anyway with a ordinary (general)<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> linear regression to see what we would get.</p>
<div class="blue">
<p>The ordinary linear regression model will fit the count data. But is it correct?</p>
</div>
<p>Here we have two predictors: the <em>experimental condition</em> <code>exp_cond</code> (there were two: <em>low-risk</em> and <em>high-risk</em>, with a zero sum contrast -1 and +1) and <em>participant’s age</em>. Age has been centered as <code>age_c</code>.</p>
<p>In this case, all predictors are significant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(trade_data<span class="sc">$</span>exp_cond) <span class="ot">&lt;-</span> <span class="fu">contr.sum</span>(<span class="dv">2</span>) <span class="co"># zero-sum contrast code</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>trade_data<span class="sc">$</span>age_c <span class="ot">&lt;-</span> <span class="fu">scale</span>(trade_data<span class="sc">$</span>age, <span class="at">scale=</span>F) <span class="co"># centre the age</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>trade.m1.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(trade_count <span class="sc">~</span> exp_cond <span class="sc">*</span> age_c, <span class="at">data=</span>trade_data) <span class="co"># run the linear regression</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(trade.m1.lm, <span class="at">show.se =</span> <span class="cn">TRUE</span>, <span class="at">collapse.se =</span> <span class="cn">TRUE</span>, <span class="at">show.loglik =</span> <span class="cn">TRUE</span>) <span class="co"># show the result in a nice table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">trade count</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">12.77<br>
(0.45)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">11.90&nbsp;–&nbsp;13.64</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">exp cond [1]</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.53<br>
(0.45)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.66&nbsp;–&nbsp;2.41</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">age c</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.08<br>
(0.04)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.15&nbsp;–&nbsp;-0.01</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.025</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">exp cond [1] × age c</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.07<br>
(0.04)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.14&nbsp;–&nbsp;-0.00</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.046</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">596</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.034 / 0.029</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">log-Likelihood</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">-2264.606</td>
</tr>
</tbody>
</table>


</div>
</div>
<p><br></p>
<p>What kind of predictions does this model make? We can create and average 100 random simulated datasets from the model, using the fitted parameters plus random noise.</p>
<div class="blue">
<p>First of all, some of these predictions are negative, which is simply not possible with count data. Participants could not make fewer than zero (negative) trades. This is a common problem with <strong>bounded data</strong> or <strong>censored data</strong>. Normal distributions (which we assume for an ordinary linear regression) are not bounded, and will try to predict negative data.</p>
<p>And it definitely does not match the shape of the original dataset. This clearly shows how an <strong>ordinary linear regression predicts normally distributed data</strong>.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>pred.samples <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span> <span class="co"># how many predictions do we want?</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate the predictions</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>pred.count <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">data=</span><span class="st">'Prediction (Ordinary Linear Regression)'</span>, <span class="at">trade_count=</span><span class="fu">as.vector</span>(<span class="fu">do.call</span>(rbind, <span class="fu">sapply</span>(pred.samples, <span class="cf">function</span>(x){<span class="fu">simulate</span>(trade.m1.lm)}))))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># bind the predictions with the raw data in a single data frame for plotting</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>pred.count <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pred.count, <span class="fu">data.frame</span>(<span class="at">data=</span><span class="st">'Original Data'</span>, <span class="at">trade_count=</span>trade_data<span class="sc">$</span>trade_count))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># show a histogram of the simulated outcomes next to the original raw data</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>pred.count, <span class="fu">aes</span>(trade_count, <span class="at">group=</span>data)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="fu">after_stat</span>(density)), <span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">binwidth=</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Trade Count"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"% of participants"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade normal predictions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="assumptions" class="level3">
<h3 class="anchored" data-anchor-id="assumptions">Assumptions</h3>
<p>There are packages in R that are very useful for checking the <strong>assumptions</strong> of a model and how well a model fits a dataset, such as <code>DHARMa</code> (which we use here) and <code>performance</code>. A good-fitting model should not have anything red highlighted on this output.</p>
<p>The output shows how this ordinary linear model has <strong>several deviations from the assumptions</strong>.</p>
<p>On the left we see that the residuals deviate from a normal distribution (the black dots should be on the red line).</p>
<p>On the right we see that the residuals are not evenly spread across the predictions, therefore there is heteroskedasticity (the solid lines - which show the 25%, 50%, and 75% quartiles - should be horizontal, showing that the dispersion of residuals is flat across the levels of predictions).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the way DHARMa works is that first we simulate the residuals, and save it</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>sim.m1.lm <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> trade.m1.lm)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># then we plot it</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim.m1.lm, <span class="at">title=</span><span class="st">"Residual diagnostics for linear model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/normal DHARMa-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="transformation-log" class="level3">
<h3 class="anchored" data-anchor-id="transformation-log">Transformation (log)</h3>
<p>If you used the log of the data, it would fit better, and all the predictors are still significant. However, there are still some red deviations highlighted.</p>
<div class="blue">
<p>The amount that you add to the log (+1 or +.01) would impact the results, coefficients, effect sizes, and inferences. If you add 0.1 instead of 1, the interaction is no longer significant.</p>
</div>
<p>Log data also would never return a trade count of zero (it would tend to zero but never be zero), which is not ideal as we clearly have zero counts in the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>trade.m1.lm.log01 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(trade_count<span class="fl">+.1</span>) <span class="sc">~</span> exp_cond <span class="sc">*</span> age_c, <span class="at">data=</span>trade_data) <span class="co"># run the log regression</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>trade.m1.lm.log1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(trade_count<span class="sc">+</span><span class="dv">1</span>) <span class="sc">~</span> exp_cond <span class="sc">*</span> age_c, <span class="at">data=</span>trade_data) <span class="co"># run the log regression</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>trade.m1.lm.log10 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(trade_count<span class="sc">+</span><span class="dv">10</span>) <span class="sc">~</span> exp_cond <span class="sc">*</span> age_c, <span class="at">data=</span>trade_data) <span class="co"># run the log regression</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(trade.m1.lm.log01, trade.m1.lm.log1, trade.m1.lm.log10, <span class="at">show.se =</span> <span class="cn">TRUE</span>, <span class="at">collapse.se =</span> <span class="cn">TRUE</span>, <span class="at">show.loglik =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">log(trade count+0.1)</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">log(trade count+1)</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">log(trade count+10)</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center;">p</td>
<td style="text-align: center;">Estimates</td>
<td style="text-align: center;">CI</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">2.07<br>
(0.05)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.97&nbsp;–&nbsp;2.17</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">2.28<br>
(0.04)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">2.21&nbsp;–&nbsp;2.36</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
<td style="text-align: center;">3.03<br>
(0.02)</td>
<td style="text-align: center;">2.99&nbsp;–&nbsp;3.06</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">exp cond [1]</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.13<br>
(0.05)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.03&nbsp;–&nbsp;0.23</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.012</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.11<br>
(0.04)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.04&nbsp;–&nbsp;0.18</td>
<td style="text-align: center;"><strong>0.003</strong></td>
<td style="text-align: center;">0.06<br>
(0.02)</td>
<td style="text-align: center;">0.02&nbsp;–&nbsp;0.09</td>
<td style="text-align: center;"><strong>0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">age c</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.01<br>
(0.00)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.02&nbsp;–&nbsp;-0.00</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.023</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.01<br>
(0.00)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.01&nbsp;–&nbsp;-0.00</td>
<td style="text-align: center;"><strong>0.029</strong></td>
<td style="text-align: center;">-0.00<br>
(0.00)</td>
<td style="text-align: center;">-0.01&nbsp;–&nbsp;-0.00</td>
<td style="text-align: center;"><strong>0.032</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">exp cond [1] × age c</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.01<br>
(0.00)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.02&nbsp;–&nbsp;0.00</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.052</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.01<br>
(0.00)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.01&nbsp;–&nbsp;-0.00</td>
<td style="text-align: center;"><strong>0.039</strong></td>
<td style="text-align: center;">-0.00<br>
(0.00)</td>
<td style="text-align: center;">-0.01&nbsp;–&nbsp;-0.00</td>
<td style="text-align: center;"><strong>0.038</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">596</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">596</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">596</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.025 / 0.020</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.029 / 0.024</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.033 / 0.028</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">log-Likelihood</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">-971.297</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">-770.473</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">-336.274</td>
</tr>
</tbody>
</table>


</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>sim.m1.lm.log01 <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> trade.m1.lm.log01) <span class="co"># runs the DHARMa output</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim.m1.lm.log01, <span class="at">title=</span><span class="st">"Residual diagnostics for linear model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade log normal model-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are better ways to analyse this data.</p>
</section>
</section>
<section id="count-distributions-poisson-and-negative-binomial" class="level2">
<h2 class="anchored" data-anchor-id="count-distributions-poisson-and-negative-binomial">Count distributions: Poisson and Negative Binomial</h2>
<div class="blue">
<p>We can check if this data fits a count distribution, in accordance with the underlying <em>counting nature of the data</em> - counting the number of trades made.</p>
</div>
<p>We can try to fit our data to a <em>Poisson</em> distribution. However it <em>does not fit the data particularly well</em> - the predictions (in red) peak later than the actual data peaks. The red lines do not match the black lines and dots.</p>
<p>The mean of this Poisson distribution is also the same mean as the normal distribution previously fitted to this data. However, the Poisson distribution <em>does not predict negative outcomes</em> (as the normal distribution did).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to fit against a poisson distribution use 'pois'</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">fitdist</span>(trade_data<span class="sc">$</span>trade_count, <span class="at">dist=</span><span class="st">"pois"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting of the distribution ' pois ' by maximum likelihood 
Parameters : 
       estimate Std. Error
lambda 12.82886  0.1467138
Loglikelihood:  -3744.46   AIC:  7490.919   BIC:  7495.31 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitdist</span>(trade_data<span class="sc">$</span>trade_count, <span class="at">dist=</span><span class="st">"pois"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade fitdistr poisson-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can try to fit a <em>Negative Binomial</em> distribution. This is a <em>much better fit</em>, even though it does not capture the peaks as well, it is the best fit so far.</p>
<div class="blue">
<p>In most experimental conditions, Negative Binomial tends to fit data better, because it is more flexible (with two parameters instead of Poisson’s single parameter).</p>
</div>
<p>Once again, the mean of the distribution is the same. But because the negatibe binomial has the extra <em>size</em> (dispersion) parameters, it fits the data better.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to fit against a negative binomial distribution use 'nbinom'</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">fitdist</span>(trade_data<span class="sc">$</span>trade_count, <span class="at">dist=</span><span class="st">"nbinom"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting of the distribution ' nbinom ' by maximum likelihood 
Parameters : 
     estimate Std. Error
size  1.49464 0.09590306
mu   12.82693 0.45404943
Loglikelihood:  -2120.557   AIC:  4245.115   BIC:  4253.895 
Correlation matrix:
             size           mu
size 1.0000000000 0.0002446197
mu   0.0002446197 1.0000000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitdist</span>(trade_data<span class="sc">$</span>trade_count, <span class="at">dist=</span><span class="st">"nbinom"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade fitdistr nbinom-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In addition to visual comparison of the outputs from this function, you could also compare the Log-Likelihoods of the outputs from the function - the closer to zero the better. The Log-Likelihood of the negative binomial distribution is much closer to zero.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<p>Another tool for identifying your type of distribution is this <strong>Ord plot</strong> named after J.K. Ord. This function is implemented in the package <code>vcd</code>. An upward trending line shows a negative binomial distribution. For more information on interpreting this plot, there are examples in the original paper by <a href="https://www.jstor.org/stable/2343403?seq=2">Ord (1967)</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Ord_plot</span>(trade_data<span class="sc">$</span>trade_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade ord plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="negative-binomial-model" class="level2">
<h2 class="anchored" data-anchor-id="negative-binomial-model">Negative Binomial model</h2>
<p>There are several packages and functions in R for fitting count data models.</p>
<p>For Poisson, the most common is probably the <code>glm</code> function from the base package, which you might have used in the past to fit logistic regressions. You simply need to specify <code>family = 'poisson'</code>.</p>
<p>For Negative Binomial, you can use the function <code>glm.nb</code> from the package <code>MASS</code>.</p>
<p>As our data more closely resembles a negative binomial, we will fit a negative binomial generalized linear regression to our data, with the same predictors.</p>
<div class="blue">
<p>Exponentiating the coefficients in count regressions (<span class="math inline">\(e^\beta\)</span>) gives us <strong>Incident Rate Ratios</strong> which has a similar interpretation to Odds Ratios (ORs).</p>
<ul>
<li>IRRs above 1 indicate positive correlation - higher incidences when the predictor goes up;</li>
<li>IRRs below 1 indicate negative correlation - higher incidences when the predictor goes down.</li>
</ul>
<p>IRRs are multiplicative (not additive) again similar to ORs.</p>
</div>
<p>With a negative binomial regression, the <strong>interaction is no longer significant</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>trade.m2.nb <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(trade_count <span class="sc">~</span> exp_cond <span class="sc">*</span> age_c, <span class="at">data=</span>trade_data) <span class="co"># run the negative binomial regression</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(trade.m2.nb, <span class="at">show.se =</span> <span class="cn">TRUE</span>, <span class="at">collapse.se =</span> <span class="cn">TRUE</span>, <span class="at">show.loglik =</span> <span class="cn">TRUE</span>) <span class="co"># show the results in a nice table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">trade count</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Incidence Rate Ratios</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">12.62<br>
(0.44)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">11.79&nbsp;–&nbsp;13.53</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">exp cond [1]</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.12<br>
(0.04)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.05&nbsp;–&nbsp;1.20</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">age c</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.99<br>
(0.00)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.99&nbsp;–&nbsp;1.00</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.034</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">exp cond [1] × age c</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.99<br>
(0.00)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.99&nbsp;–&nbsp;1.00</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.065</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">596</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> Nagelkerke</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.047</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">log-Likelihood</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">-2110.859</td>
</tr>
</tbody>
</table>


</div>
</div>
<p><br></p>
<p>Again we simulate a series of 100 predicted datasets from our model and compare it to the original dataset. It’s a <strong>much better fit</strong> - there are no predictions below 0. The shape of the distribution of predictions <strong>closely matches the original data</strong> distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pred.samples <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span> <span class="co"># how many predictions do we want?</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate the predictions</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>pred.count <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">data=</span><span class="st">'Prediction (Neg Bin)'</span>, <span class="at">trade_count=</span><span class="fu">as.vector</span>(<span class="fu">do.call</span>(rbind, <span class="fu">sapply</span>(pred.samples, <span class="cf">function</span>(x){<span class="fu">simulate</span>(trade.m2.nb)}))))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># bind the predictions with the raw data in a single data frame for plotting</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>pred.count <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pred.count, <span class="fu">data.frame</span>(<span class="at">data=</span><span class="st">'Original Data'</span>, <span class="at">trade_count=</span>trade_data<span class="sc">$</span>trade_count))</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># show a histogram of the simulated outcomes next to the original raw data</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>pred.count, <span class="fu">aes</span>(trade_count, <span class="at">group=</span>data)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="fu">after_stat</span>(density)), <span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">binwidth=</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Trade Count"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"% of participants"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>data) <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade nb predictions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If we look at the two models side-by-side, we see that we would make different inferences from each model with regards to the interactions. The coefficients are not directly comparable. But we can ask R to give us some estimated marginal means.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(trade.m1.lm, trade.m2.nb, <span class="at">show.se =</span> <span class="cn">TRUE</span>, <span class="at">collapse.se =</span> <span class="cn">TRUE</span>, <span class="at">show.loglik =</span> <span class="cn">TRUE</span>, <span class="at">dv.labels=</span><span class="fu">c</span>(<span class="st">"general linear model"</span>, <span class="st">"negative binomial model"</span>)) <span class="co"># show the two models side by side</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">general linear model</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">negative binomial model</td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Estimates</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Incidence Rate Ratios</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">12.77<br>
(0.45)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">11.90&nbsp;–&nbsp;13.64</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">12.62<br>
(0.44)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">11.79&nbsp;–&nbsp;13.53</td>
<td style="text-align: center;"><strong>&lt;0.001</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">exp cond [1]</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.53<br>
(0.45)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.66&nbsp;–&nbsp;2.41</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.001</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.12<br>
(0.04)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.05&nbsp;–&nbsp;1.20</td>
<td style="text-align: center;"><strong>0.001</strong></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">age c</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.08<br>
(0.04)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.15&nbsp;–&nbsp;-0.01</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.025</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.99<br>
(0.00)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.99&nbsp;–&nbsp;1.00</td>
<td style="text-align: center;"><strong>0.034</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">exp cond [1] × age c</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.07<br>
(0.04)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">-0.14&nbsp;–&nbsp;-0.00</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.046</strong></td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.99<br>
(0.00)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.99&nbsp;–&nbsp;1.00</td>
<td style="text-align: center;">0.065</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">596</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">596</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.034 / 0.029</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.047</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">log-Likelihood</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">-2264.606</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">-2110.859</td>
</tr>
</tbody>
</table>


</div>
</div>
<p><br></p>
<p>We can compare the predictions that the model makes of the means of each experimental condition using the functions <code>emmeans</code> and <code>emmip</code>.</p>
<div class="blue">
<p>They are close in this case - general linear regressions are very good at finding the means of distribution - the differences in this case are in the <strong>standard errors</strong>. This translates into differences in the <em>effect sizes</em> and <em>interpretation of the results</em>.</p>
<p>If there were extreme (very large) values, as we will see later, the results would not have been so similar.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the means for each experimental condition, for each model</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>emmeans.lm <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">emmeans</span>(trade.m1.lm, <span class="sc">~</span>exp_cond, <span class="at">type=</span><span class="st">"r"</span>))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>emmeans.lm<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"lm"</span> <span class="co"># name the models for the plot below</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>emmeans.nb <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">emmeans</span>(trade.m2.nb, <span class="sc">~</span>exp_cond, <span class="at">type=</span><span class="st">"r"</span>))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>emmeans.nb<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"nb"</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(emmeans.nb) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(emmeans.lm) <span class="co"># we need the column names to be the same for the rbind below</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the results</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">rbind</span>(emmeans.lm, emmeans.nb), <span class="fu">aes</span>(<span class="at">x=</span>exp_cond, <span class="at">y=</span>emmean, <span class="at">ymin=</span>lower.CL, <span class="at">ymax=</span>upper.CL, <span class="at">group=</span>model, <span class="at">color=</span>model, <span class="at">fill=</span>model)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">width=</span><span class="fl">0.5</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.55</span>), <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="at">width=</span><span class="fl">0.2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.55</span>), <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"experimental condition"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"estimated marginal means"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade emmeans-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the slopes of age for each experimental condition, for each model</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>emmip.lm <span class="ot">&lt;-</span> <span class="fu">emmip</span>(trade.m1.lm, <span class="sc">~</span>age_c<span class="sc">|</span>exp_cond, <span class="at">at=</span><span class="fu">list</span>(<span class="at">age_c=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">40</span>)), <span class="at">CIs=</span>T, <span class="at">plotit =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>emmip.lm<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"lm"</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>emmip.nb <span class="ot">&lt;-</span> <span class="fu">emmip</span>(trade.m2.nb, <span class="sc">~</span>age_c<span class="sc">|</span>exp_cond, <span class="at">at=</span><span class="fu">list</span>(<span class="at">age_c=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">40</span>)), <span class="at">CIs=</span>T, <span class="at">type=</span><span class="st">"r"</span>, <span class="at">plotit =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>emmip.nb<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"nb"</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(emmip.nb) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(emmip.lm)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">rbind</span>(emmip.lm, emmip.nb), <span class="fu">aes</span>(<span class="at">x=</span>age_c, <span class="at">y=</span>yvar, <span class="at">ymin=</span>LCL, <span class="at">ymax=</span>UCL, <span class="at">group=</span>model, <span class="at">color=</span>model, <span class="at">fill=</span>model)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="dv">1</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="dv">1</span>), <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"centered Age in years"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"estimated marginal means"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>exp_cond)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/trade emmeans-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can look at the diagnostics again, and we see <strong>no deviations</strong> with the negative binomial model (nothing is highlighted in red, apart from a couple of potential outliers).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>sim.m2.nb <span class="ot">&lt;-</span> <span class="fu">simulateResiduals</span>(<span class="at">fittedModel =</span> trade.m2.nb)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sim.m2.nb, <span class="at">title=</span><span class="st">"Residual diagnostics for negative binomial model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/nb DHARMa-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="repeated-measures-mixed-effects-example" class="level1">
<h1>Repeated-measures (Mixed effects) Example</h1>
<p>In this new example, the data (<code>sampling_data</code>) comes from a decision-making study.</p>
<p>Before making a financially-consequential decision that affected their bonus, participants could freely sample from the available options without any costs or consequences, to determine which option they preferred.</p>
<p>This is again count data, as it counts the number of samples taken by each participant before each choice. They could sample for as long as they liked. Each participant made 18 choices, and they could sample a different number of times for each choice.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histogram of sample count</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sampling_data, <span class="fu">aes</span>(<span class="at">x =</span> sample_count)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">binwidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Number of samples taken before each choice"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/sampling data histogram-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It’s not immediately obvious, but the peak of the data (and also the lowest count of samples) is not zero, but instead, it is 2. That is because participants were required to sample at least twice for each choice they made, although there was no upper bound.</p>
<div class="blue">
<p>With count data it’s always best to have the data starting from zero if there was some structural characteristic that limited the minimum count. We create a new variable, <em>excess sample count</em>, which counts how many samples participants took <em>in excess</em> of the minimum. This was calculated by subtracting 2 from each sample count.</p>
</div>
<p>Now the data starts from zero, which will help it more closely match a count distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subtract two to create excess sample count</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>sampling_data<span class="sc">$</span>excess_sample_count <span class="ot">&lt;-</span> sampling_data<span class="sc">$</span>sample_count <span class="sc">-</span> <span class="dv">2</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the new excess sample count</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sampling_data, <span class="fu">aes</span>(<span class="at">x =</span> excess_sample_count)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">binwidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Number of excess samples taken before each choice"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/sample excess sample count-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Again this data is clearly not normally distributed, but instead it seems to follow a negative binomial distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare trade_count data with a normal distribution</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">fitdist</span>(sampling_data<span class="sc">$</span>excess_sample_count,<span class="at">dist=</span><span class="st">"norm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting of the distribution ' norm ' by maximum likelihood 
Parameters : 
     estimate Std. Error
mean 5.620428  0.1414394
sd   8.750989  0.1000129
Loglikelihood:  -13735.27   AIC:  27474.53   BIC:  27487.03 
Correlation matrix:
             mean           sd
mean 1.000000e+00 1.875147e-06
sd   1.875147e-06 1.000000e+00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitdist</span>(sampling_data<span class="sc">$</span>excess_sample_count,<span class="at">dist=</span><span class="st">"norm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/sample fitdist-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare trade_count data with a negative binomial distribution</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">fitdist</span>(sampling_data<span class="sc">$</span>excess_sample_count,<span class="at">dist=</span><span class="st">"nbinom"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting of the distribution ' nbinom ' by maximum likelihood 
Parameters : 
      estimate Std. Error
size 0.3879878 0.01075305
mu   5.6212534 0.15083192
Loglikelihood:  -10123.22   AIC:  20250.45   BIC:  20262.95 
Correlation matrix:
              size            mu
size  1.0000000000 -0.0001418066
mu   -0.0001418066  1.0000000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitdist</span>(sampling_data<span class="sc">$</span>excess_sample_count,<span class="at">dist=</span><span class="st">"nbinom"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/sample fitdist-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Because this was <em>within-subjects (repeated measures)</em> with each participant making 18 choices (and each choice associated with its own sampling) we need to fit a <em>mixed effects model</em> to this data.</p>
<p>The best package for this is <code>glmmTMB</code> which is flexible enough to allow for several different distributions, including negative binomial.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<p>There were <em>two experimental conditions</em> <code>expcond</code>, and we also add two continuous predictors: <em>age</em> and <em>choice number</em> (both centered). Choice number was the sequential choice they made, from 1 to 18, to see if sampling behaviour changed as they made more choices and the task progressed. There is a random intercept for each participant. The random effects are specified using the same format as the more traditional <code>lmer</code> or <code>glmer</code> functions.</p>
<div class="blue">
<p>We compare the outputs with an ordinary linear regression. The conclusions would have been different. We can see that one of the predictors (experimental condition) is significant with the negative binomial regression, but not with the ordinary linear regression.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrasts</span>(sampling_data<span class="sc">$</span>expcond) <span class="ot">&lt;-</span> <span class="fu">contr.sum</span>(<span class="dv">2</span>) <span class="co"># zero-sum contrast code</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>sampling_data<span class="sc">$</span>choice_number_c <span class="ot">&lt;-</span> <span class="fu">scale</span>(sampling_data<span class="sc">$</span>choice_number, <span class="at">scale=</span><span class="cn">FALSE</span>) <span class="co"># centre the choice number</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>sampling_data<span class="sc">$</span>age_c <span class="ot">&lt;-</span> <span class="fu">scale</span>(sampling_data<span class="sc">$</span>age, <span class="at">scale=</span><span class="cn">FALSE</span>) <span class="co"># centre the age</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># run an ordinary mixed effects linear regression</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>sample.m1.lm <span class="ot">&lt;-</span> <span class="fu">lmer</span>(excess_sample_count <span class="sc">~</span> expcond <span class="sc">+</span> age_c <span class="sc">+</span> choice_number_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>pptid), <span class="at">data=</span>sampling_data)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co"># run a negative binomial mixed effects regression</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>sample.m2.nb <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(excess_sample_count <span class="sc">~</span> expcond <span class="sc">+</span> age_c <span class="sc">+</span> choice_number_c <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>pptid), <span class="at">data=</span>sampling_data, <span class="at">family=</span><span class="st">"nbinom1"</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(sample.m1.lm, sample.m2.nb, <span class="at">show.se =</span> <span class="cn">TRUE</span>, <span class="at">collapse.se =</span> <span class="cn">TRUE</span>, <span class="at">show.loglik =</span> <span class="cn">TRUE</span>, <span class="at">show.icc=</span><span class="cn">FALSE</span>, <span class="at">show.re.var =</span> <span class="cn">FALSE</span>, <span class="at">dv.labels=</span><span class="fu">c</span>(<span class="st">"ordinary mixed-effects linear model"</span>, <span class="st">"negative binomial mixed-effects model"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table style="border-collapse:collapse; border:none;">
<tbody><tr>
<th style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm;  text-align:left; ">&nbsp;</th>
<th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">ordinary mixed-effects linear model</th>
<th colspan="3" style="border-top: double; text-align:center; font-style:normal; font-weight:bold; padding:0.2cm; ">negative binomial mixed-effects model</th>
</tr>
<tr>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  text-align:left; ">Predictors</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">Estimates</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">CI</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">p</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">Incidence Rate Ratios</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  ">CI</td>
<td style=" text-align:center; border-bottom:1px solid; font-style:italic; font-weight:normal;  col7">p</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">(Intercept)</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">5.64<br>(0.44)</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">4.78&nbsp;–&nbsp;6.51</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "><strong>&lt;0.001</strong></td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">1.78<br>(0.19)</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">1.44&nbsp;–&nbsp;2.20</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"><strong>&lt;0.001</strong></td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">expcond1</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">-0.12<br>(0.07)</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">-0.25&nbsp;–&nbsp;0.01</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">0.068</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">0.98<br>(0.01)</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">0.96&nbsp;–&nbsp;1.00</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"><strong>0.049</strong></td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">age c</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">-0.04<br>(0.04)</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">-0.11&nbsp;–&nbsp;0.03</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">0.322</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">0.99<br>(0.01)</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">0.98&nbsp;–&nbsp;1.01</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7">0.515</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; ">choice number c</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">-0.10<br>(0.01)</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">-0.13&nbsp;–&nbsp;-0.08</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  "><strong>&lt;0.001</strong></td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">0.98<br>(0.00)</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  ">0.98&nbsp;–&nbsp;0.99</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:center;  col7"><strong>&lt;0.001</strong></td>
</tr>

<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">N</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">316 <sub>pptid</sub></td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">316 <sub>pptid</sub></td>
</tr><tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm; border-top:1px solid;">Observations</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3">3792</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left; border-top:1px solid;" colspan="3">3792</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">Marginal R<sup>2</sup> / Conditional R<sup>2</sup></td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">0.006 / 0.780</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">0.003 / 0.849</td>
</tr>
<tr>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; text-align:left; padding-top:0.1cm; padding-bottom:0.1cm;">log-Likelihood</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">-11354.371</td>
<td style=" padding:0.2cm; text-align:left; vertical-align:top; padding-top:0.1cm; padding-bottom:0.1cm; text-align:left;" colspan="3">-7675.980</td>
</tr>

</tbody></table>

</div>
</div>
<p>When we compare the model outputs, we see a <strong>large difference in the estimate of the sample count</strong>. This is because the ordinary linear model is heavily influenced by some <strong>very large sample counts</strong>, which push the average up.</p>
<div class="blue">
<p>Because of these extreme values, the estimated marginal means from count models can be significantly different from the actual means of the underlying data, and will be closer to the median, which was 2. In comparison, the estimated marginal means from general linear models will be closer to the mean, which was 5.62.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># emmeans is used to create estimated marginal means for each experimental condition</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># we calculate these for each model</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>emmeans.lm <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">emmeans</span>(sample.m1.lm, <span class="sc">~</span>expcond, <span class="at">type=</span><span class="st">"r"</span>, <span class="at">lmer.df =</span> <span class="st">"asymp"</span>))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>emmeans.lm<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"lm"</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>emmeans.nb <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">emmeans</span>(sample.m2.nb, <span class="sc">~</span>expcond, <span class="at">type=</span><span class="st">"r"</span>, <span class="at">lmer.df =</span> <span class="st">"asymp"</span>))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>emmeans.nb<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"nb"</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(emmeans.nb) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(emmeans.lm)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">rbind</span>(emmeans.lm, emmeans.nb), <span class="fu">aes</span>(<span class="at">x=</span>expcond, <span class="at">y=</span>emmean, <span class="at">ymin=</span>asymp.LCL, <span class="at">ymax=</span>asymp.UCL, <span class="at">group=</span>model, <span class="at">color=</span>model, <span class="at">fill=</span>model)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, <span class="at">width=</span><span class="fl">0.5</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.55</span>), <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="at">width=</span><span class="fl">0.2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.55</span>), <span class="at">color=</span><span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"experimental condition"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"estimated marginal means"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/sample emmeans-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># emmip is used to create regression lines for each predictor</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>emmip.lm <span class="ot">&lt;-</span> <span class="fu">emmip</span>(sample.m1.lm, <span class="sc">~</span>age_c, <span class="at">at=</span><span class="fu">list</span>(<span class="at">age_c=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">40</span>)), <span class="at">CIs=</span>T, <span class="at">plotit =</span> <span class="cn">FALSE</span>, <span class="at">lmer.df =</span> <span class="st">"asymp"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>emmip.lm<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"lm"</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>emmip.nb <span class="ot">&lt;-</span> <span class="fu">emmip</span>(sample.m2.nb, <span class="sc">~</span>age_c, <span class="at">at=</span><span class="fu">list</span>(<span class="at">age_c=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">20</span><span class="sc">:</span><span class="dv">40</span>)), <span class="at">CIs=</span>T, <span class="at">type=</span><span class="st">"r"</span>, <span class="at">plotit =</span> <span class="cn">FALSE</span>, <span class="at">lmer.df =</span> <span class="st">"asymp"</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>emmip.nb<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"nb"</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">rbind</span>(emmip.lm, emmip.nb), <span class="fu">aes</span>(<span class="at">x=</span>age_c, <span class="at">y=</span>yvar, <span class="at">ymin=</span>LCL, <span class="at">ymax=</span>UCL, <span class="at">group=</span>model, <span class="at">color=</span>model, <span class="at">fill=</span>model)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="dv">1</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="dv">1</span>), <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Centered age in years"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"estimated marginal means"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/sample emmeans-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>emmip.lm <span class="ot">&lt;-</span> <span class="fu">emmip</span>(sample.m1.lm, <span class="sc">~</span>choice_number_c, <span class="at">at=</span><span class="fu">list</span>(<span class="at">choice_number_c=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">10</span>)), <span class="at">CIs=</span>T, <span class="at">plotit =</span> <span class="cn">FALSE</span>, <span class="at">lmer.df =</span> <span class="st">"asymp"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>emmip.lm<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"lm"</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>emmip.nb <span class="ot">&lt;-</span> <span class="fu">emmip</span>(sample.m2.nb, <span class="sc">~</span>choice_number_c, <span class="at">at=</span><span class="fu">list</span>(<span class="at">choice_number_c=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span><span class="sc">:</span><span class="dv">10</span>)), <span class="at">CIs=</span>T, <span class="at">type=</span><span class="st">"r"</span>, <span class="at">plotit =</span> <span class="cn">FALSE</span>, <span class="at">lmer.df =</span> <span class="st">"asymp"</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>emmip.nb<span class="sc">$</span>model <span class="ot">&lt;-</span> <span class="st">"nb"</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">rbind</span>(emmip.lm, emmip.nb), <span class="fu">aes</span>(<span class="at">x=</span>choice_number_c, <span class="at">y=</span>yvar, <span class="at">ymin=</span>LCL, <span class="at">ymax=</span>UCL, <span class="at">group=</span>model, <span class="at">color=</span>model, <span class="at">fill=</span>model)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="dv">1</span>), <span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="dv">1</span>), <span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Centered Choice number"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"estimated marginal means"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/sample emmeans-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="zero-inflation" class="level1">
<h1>Zero inflation</h1>
<p>In this final example, the data (<code>zi_data</code>) comes from a study on gambling.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<p>Participants were given £3 and allowed to place as many bets as they wanted across four simulated slot machines. We measured how often participants switched between the different machines. They did not have to switch at all, and could switch as many times as they wanted. We also measured the participants’ PGSI, which is the problem gambling severity index: higher scores in the PGSI correlate with more disordered gambling and more harm from gambling.</p>
<div class="blue">
<p>What we have here is what we call <strong>zero-inflated</strong> data, or data which has more zero observations than we would expect. These are the participants that did not switch between slot machines and placed all their bets with a single machine.</p>
<p>Zero-inflation count data often has two peaks, one at zero, then a dip in responses, and another peak later on, as we see here. If there is a single peak, there might not be zero inflation at all.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the histogram of number of switches</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(zi_data, <span class="fu">aes</span>(<span class="at">x =</span> switch_count)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">binwidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Number of switches between the different slot machines"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/zi data histogram-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In fact, 30% of participants did not switch at all.</p>
<p>When we compare this data to a normal distribution and to a negative binomial distribution, we can see the excess zero responses. The negative binomial distribution fits the data slightly better but it’s still quite different, because of the excess zeros.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare number of switches data with a normal distribution</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">fitdist</span>(zi_data<span class="sc">$</span>switch_count,<span class="at">dist=</span><span class="st">"norm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting of the distribution ' norm ' by maximum likelihood 
Parameters : 
     estimate Std. Error
mean 2.768229  0.1576408
sd   3.089116  0.1114688
Loglikelihood:  -977.9802   AIC:  1959.96   BIC:  1967.862 
Correlation matrix:
              mean            sd
mean  1.000000e+00 -2.197479e-08
sd   -2.197479e-08  1.000000e+00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitdist</span>(zi_data<span class="sc">$</span>switch_count,<span class="at">dist=</span><span class="st">"norm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/zi fitdist-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compare number of switches data with a negative binomial distribution</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>fit_output_nb <span class="ot">&lt;-</span> <span class="fu">fitdist</span>(zi_data<span class="sc">$</span>switch_count,<span class="at">dist=</span><span class="st">"nbinom"</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_output_nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting of the distribution ' nbinom ' by maximum likelihood 
Parameters : 
      estimate Std. Error
size 0.9847249  0.1127879
mu   2.7679689  0.1657271
Loglikelihood:  -837.2336   AIC:  1678.467   BIC:  1686.368 
Correlation matrix:
             size           mu
size 1.0000000000 0.0001327684
mu   0.0001327684 1.0000000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit_output_nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/zi fitdist-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What we have here is a count distribution with a relatively high mean – if you ignore the excessive zeros.</p>
<p>The fit function in R tries to compensate by fitting a distribution with a smaller mean (mu) and larger variance (size) to account for the excessive zeros. However, it’s not a very good fit. Accounting for the excessive zeros and allowing for a larger mean would fit this data better.</p>
<section id="testing-for-zero-inflation" class="level2">
<h2 class="anchored" data-anchor-id="testing-for-zero-inflation">Testing for zero-inflation</h2>
<div class="blue">
<p>We can test if the data has zero inflation in a few different ways.</p>
</div>
<section id="fit-a-zero-inflated-distribution" class="level3">
<h3 class="anchored" data-anchor-id="fit-a-zero-inflated-distribution">Fit a zero-inflated distribution</h3>
<p>First, we can try the <code>fitdist</code> function by specifying the <code>ZINBI</code> distribution from package <code>gamlss</code>.</p>
<p>However, this is always clunky and likes to throw many warnings and errors. But in this case, the AIC is smaller and it seems to fit better than a regular negative binomial distribution. You can also see how it now estimated a higher mean (mu).</p>
<p><em>Nu</em> is the probability of responding with a zero, or the zero-inflation parameter, which was 0.208. The zero-inflated distribution assumes that there were around 21% excessive zeros.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To run a ZINBI fit you need to specify starting points for the different parameters, as well as bounds for the parameters. Sometimes you need to try different starting parameters until it fits.</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>fit_output_zinbi <span class="ot">&lt;-</span> <span class="fu">fitdist</span>(zi_data<span class="sc">$</span>switch_count, <span class="at">dist=</span><span class="st">"ZINBI"</span>, <span class="at">start=</span><span class="fu">list</span>(<span class="at">mu=</span><span class="dv">1</span>, <span class="at">sigma=</span><span class="dv">1</span>, <span class="at">nu=</span><span class="fl">0.1</span>), <span class="at">upper=</span><span class="fu">c</span>(<span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="dv">1</span>), <span class="at">lower=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="at">discrete=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_output_zinbi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting of the distribution ' ZINBI ' by maximum likelihood 
Parameters : 
       estimate Std. Error
mu    3.4937468 0.04500344
sigma 0.4335047 0.08676652
nu    0.2076853 0.05081428
Loglikelihood:  -828.697   AIC:  1663.394   BIC:  1675.246 
Correlation matrix:
              mu      sigma         nu
mu     1.0000000 -0.5240354  0.2766188
sigma -0.5240354  1.0000000 -0.2524488
nu     0.2766188 -0.2524488  1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit_output_zinbi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/zi fitdist zinb-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also plot a typical negative binomial distribution (without zero inflation) over our data to see how the zero inflation works. The plot below shows that without the zero inflation part, the negative binomial fits the second peak of the data, with a higher average (mu) and smaller variance (sigma).</p>
<p>The negative binomial predicts around 10% are zeros, but the actual observed zero count was 30%. The difference in zeros is accounted by the 21% excessive zeros.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we compare the zero inflated data to a negative binomial model, without zero inflation, but with the mu and sigma from the zero inflation model.</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># this shows us the zero inflation component</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotdist</span>(zi_data<span class="sc">$</span>switch_count, <span class="at">dist=</span><span class="st">"NBI"</span>, <span class="at">para=</span><span class="fu">list</span>(<span class="at">sigma=</span><span class="fu">coef</span>(fit_output_zinbi)[<span class="st">'sigma'</span>], <span class="at">mu=</span><span class="fu">coef</span>(fit_output_zinbi)[<span class="st">'mu'</span>]), <span class="at">discrete=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/zi plotdist zinb-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="run-a-negative-binomial-and-test-for-zero-inflation" class="level3">
<h3 class="anchored" data-anchor-id="run-a-negative-binomial-and-test-for-zero-inflation">Run a negative binomial and test for zero inflation</h3>
<p>Alternatively, we can run a negative binomial regression (without zero inflation) using the same <code>glm.nb</code> function as before, and use the <code>testZeroInflation</code> function from <code>DHARMa</code>.</p>
<p>Significant values above 1 mean that there is zero inflation. Ideally the red line in the plot below should be in the middle of the data distribution. Because the data is to the left of the red line, and the statistic is significant, this test confirms that there is zero inflation.<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r fold-show code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>zi.m2.nb <span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(switch_count <span class="sc">~</span> pgsi, <span class="at">data=</span>zi_data) <span class="co"># run a standard negative binomial regression</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">testZeroInflation</span>(zi.m2.nb) <span class="co"># test for zero inflation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/zero inflation test-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    DHARMa zero-inflation test via comparison to expected zeros with
    simulation under H0 = fitted model

data:  simulationOutput
ratioObsSim = 1.1837, p-value = 0.024
alternative hypothesis: two.sided</code></pre>
</div>
</div>
</section>
<section id="compare-a-negative-binomial-model-with-a-zero-inflated-model" class="level3">
<h3 class="anchored" data-anchor-id="compare-a-negative-binomial-model-with-a-zero-inflated-model">Compare a negative binomial model with a zero-inflated model</h3>
<p>Finally, another way to test is to run a <strong>Zero-Inflation Negative Binomial</strong> (<code>ZINB</code>) <span class="math inline">\(-\)</span> or <code>ZIP</code> for <strong>Zero-Inflated Poisson</strong> <span class="math inline">\(-\)</span> regression and compare the two models. There are several packages that allow for zero-inflated models, but one of the simplest is the function <code>zeroinfl</code> from package <code>pscl</code>.<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></p>
<p>Zero-inflation models assume that two different and separate processes generate the data.</p>
<ul>
<li><p><strong>Zero inflation</strong>: This process is responsible for excessive zero responses (in other words, is the response going to be an excessive zero, more than expected?). This is commonly estimated using a binary logistic regression. In this example, did the participant decide to switch between slot machines at all?</p></li>
<li><p><strong>Conditional regression</strong>: Then, assuming that the model does not classify this response as an excessive zero, a conditional negative binomial regression is run (conditional that the result is not an excessive zero) to determine the actual response, in this case, the number of switches between different machines.</p></li>
</ul>
<p>It is important to note that the conditional regression part of the model can also return a count of zero, and the zero-inflation part is only responsible for excessive zeros (or inflation of zeros). If you believe this cannot be the case, then <strong>Hurdle</strong> models do not allow for zeros in the conditional part, only the zero-inflation part generates zeros. You can think of this as a hurdle that the participant has to pass (e.g., is the response a zero or not).</p>
<p><strong>NB</strong>: The packages that allow for zero-inflation often require the zero-inflation part of the model to be specified separately. In the case of the <code>zeroinfl</code> function, if you don’t specify anything, the function assumes that the zero inflation part of the model is the same as the conditional part of the mode, ie, it has the same predictors. This is the simplest and easiest approach.<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a></p>
<div class="blue">
<p>We can then compare the two models to see if the zero-inflated model fits the data better. The model with the lowest AIC is considered to fit the data better, and that’s the case here for the ZINB model in comparison to the NB model (without zero-inflation).<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a></p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run a zero-inflation negative binomial regression</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>zi.m3.zinb <span class="ot">&lt;-</span> <span class="fu">zeroinfl</span>(switch_count <span class="sc">~</span> pgsi, <span class="at">data=</span>zi_data, <span class="at">dist=</span><span class="st">"negbin"</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># compare the AICs of the two models. Lower AIC is better.</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(zi.m2.nb, zi.m3.zinb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           df      AIC
zi.m2.nb    3 1638.248
zi.m3.zinb  5 1565.833</code></pre>
</div>
</div>
<p>The output from zero-inflation models follow the two components described above: The <strong>conditional</strong> and the <strong>zero-inflation</strong> components.</p>
<ul>
<li><p>The zero-inflation component outputs Odds-Ratios (OR) based on a binary logistic regression (1 = excess zero). It measures the likelihood of a participant responding with an excessive zero response or not. Note that this part of the model is positively correlated with zero responses, therefore negatively correlated with actual bets placed Higher ORs here indicate a higher propensity to respond with a zero (and therefore a lower number of switches overall).</p>
<ul>
<li>In this example, the PGSI predictor was significant, with an OR below 1. Participants with higher PGSI scores were less likely to not switch at all.</li>
</ul></li>
</ul>
<p><br></p>
<ul>
<li><p>The conditional component Incidence Rate Ratios (IRRs) based on a negative binomial regression. IRRs above 1 indicate a higher switch count and vice-versa.</p>
<ul>
<li>In this example, PGSI scores significantly influenced how often a participant switched between slot machines. The OR was significantly above 1, which means that with higher PGSI scores, participants switched more times.</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tab_model</span>(zi.m3.zinb) <span class="co"># nice table of the results of the ZINB model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">&nbsp;</td>
<td colspan="3" data-quarto-table-cell-role="th" style="text-align: center; border-top: double; font-style: normal; font-weight: bold; padding: 0.2cm;">switch count</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Predictors</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">Incidence Rate Ratios</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">CI</td>
<td style="text-align: center; border-bottom: 1px solid; font-style: italic; font-weight: normal;">p</td>
<td></td>
</tr>
<tr class="odd">
<td colspan="5" style="text-align: left; font-weight: bold; padding-top: .8em;">Count Model</td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">3.17</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">2.73&nbsp;–&nbsp;3.69</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">pgsi</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.07</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.02&nbsp;–&nbsp;1.11</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>0.004</strong></td>
<td></td>
</tr>
<tr class="even">
<td colspan="4" style="text-align: left; font-weight: bold; padding-top: .8em;">Zero-Inflated Model</td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">(Intercept)</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">1.09</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.75&nbsp;–&nbsp;1.58</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.641</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">pgsi</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.31</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;">0.22&nbsp;–&nbsp;0.45</td>
<td style="text-align: left; padding: 0.2cm; vertical-align: top;"><strong>&lt;0.001</strong></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">Observations</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm; border-top: 1px solid;">384</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">R<sup>2</sup> / R<sup>2</sup> adjusted</td>
<td colspan="3" style="text-align: left; padding: 0.2cm; vertical-align: top; padding-top: 0.1cm; padding-bottom: 0.1cm;">0.525 / 0.523</td>
<td></td>
</tr>
</tbody>
</table>


</div>
</div>
<p>We can compare model predictions to see how the zero-inflated model predicts many more zeros and more closely matches the original dataset. We see that the zero-inflated model fits the data better.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>pred.samples <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span> <span class="co"># how many predictions do we want?</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate the predictions for negative binomial</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>pred.count.nb <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">data=</span><span class="st">'Prediction (Negative Binomial)'</span>, <span class="at">switch_count=</span><span class="fu">as.vector</span>(<span class="fu">do.call</span>(rbind, <span class="fu">sapply</span>(pred.samples, <span class="cf">function</span>(x){<span class="fu">simulate</span>(zi.m2.nb)}))))</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate the predictions for the ZINB model</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>probabilities <span class="ot">&lt;-</span> <span class="fu">predict</span>(zi.m3.zinb, <span class="at">type=</span><span class="st">"prob"</span>) <span class="co"># get the probabilities</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>pred.count.zi <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">data=</span><span class="st">'Prediction (Zero-Inflated Neg Bin)'</span>, <span class="at">switch_count=</span><span class="fu">as.vector</span>(<span class="fu">sapply</span>(pred.samples, <span class="cf">function</span>(s){<span class="fu">apply</span>(probabilities, <span class="dv">1</span>, <span class="cf">function</span>(p) <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(probabilities), <span class="dv">1</span>, <span class="at">prob=</span>p))})))</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co"># bind the predictions with the raw data in a single data frame for plotting</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>pred.count <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pred.count.nb, pred.count.zi, <span class="fu">data.frame</span>(<span class="at">data=</span><span class="st">'Original Data'</span>, <span class="at">switch_count=</span>zi_data<span class="sc">$</span>switch_count))</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co"># show a histogram of the simulated outcomes next to the original raw data</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>pred.count, <span class="fu">aes</span>(switch_count, <span class="at">group=</span>data)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="fu">after_stat</span>(density)), <span class="at">fill=</span><span class="st">"lightblue"</span>, <span class="at">color=</span><span class="st">"black"</span>, <span class="at">binwidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Switch Count"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"% of participants"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>data) <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/zi predictions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>When interpreting the results of a zero-inflated model, you need to consider both components separately, the zero-inflated and the conditional components. Not only the coefficients, predictors, and their significance, but also their estimated marginal means.</p>
<p>You can do that by setting the component of the regression that you want to evaluate at each time, often using <code>component=...</code> or <code>mode=...</code>. These can be identified using <code>zero</code> or <code>zi</code> for zero-inflation and <code>count</code> or <code>cond</code> for the conditional component. Each function requires slightly different parameters, so check the help.</p>
<div class="blue">
<p>If you don’t set the component for your analyses, often you will only be shown the conditional component by default. Be careful as this is only part of the picture.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># emmip is used to calculate the slope of the predictors against the DV</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># one is needed for each component of the zero-inflation regression.</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>emout.zero <span class="ot">&lt;-</span> <span class="fu">emmip</span>(zi.m3.zinb, <span class="sc">~</span>pgsi, <span class="at">at=</span><span class="fu">list</span>(<span class="at">pgsi=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>), <span class="at">type=</span><span class="st">"r"</span>, <span class="at">CIs=</span>T, <span class="at">mode=</span><span class="st">"zero"</span>, <span class="at">plotit=</span><span class="cn">FALSE</span>) </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>emout.zero<span class="sc">$</span>component <span class="ot">&lt;-</span> <span class="st">"zero inflation"</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>emout.cond <span class="ot">&lt;-</span> <span class="fu">emmip</span>(zi.m3.zinb, <span class="sc">~</span>pgsi, <span class="at">at=</span><span class="fu">list</span>(<span class="at">pgsi=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>), <span class="at">type=</span><span class="st">"r"</span>, <span class="at">CIs=</span>T, <span class="at">mode=</span><span class="st">"count"</span>, <span class="at">plotit=</span><span class="cn">FALSE</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>emout.cond<span class="sc">$</span>component <span class="ot">&lt;-</span> <span class="st">"conditional"</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">rbind</span>(emout.zero, emout.cond), <span class="fu">aes</span>(<span class="at">x=</span>pgsi, <span class="at">y=</span>yvar, <span class="at">ymin=</span>LCL, <span class="at">ymax=</span>UCL)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">linewidth=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="at">alpha=</span><span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"pgsi"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Count of Switches / Probability of Excess Zero"</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>component, <span class="at">scales=</span><span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Count-Data_files/figure-html/zi emmeans-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="postscript-dont-like-to-use-r" class="level1">
<h1>Postscript: Don’t like to use R?</h1>
<p>If you don’t like using R, Jamovi has an implementation for Poisson and Negative Binomial regressions including mixed effects, while JASP supports only Poisson distributions (also mixed effects). Neither seems to support zero inflation at the moment.</p>
</section>
<section id="further-reading" class="level1">
<h1>Further reading</h1>
<p>There are several useful online guides on count data analysis. Here are some that I have found:</p>
<p><a href="https://cran.r-project.org/web/packages/pscl/vignettes/countreg.pdf">Regression Models for Count Data in R using the pscl package</a></p>
<p><a href="https://stats.oarc.ucla.edu/r/dae/negative-binomial-regression/">UCLA’s Advanced Research Computing Statistical Methods and Data Analytics page on Negative Binomial Regression</a> <a href="https://stats.oarc.ucla.edu/r/dae/zinb/">… and Zero Inflated Negative Binomial Regression</a></p>
<p><a href="https://www.r-bloggers.com/2022/06/the-poisson-distribution-from-basic-probability-theory-to-regression-models/">The Poisson distribution: From basic probability theory to regression models</a></p>
<p><a href="https://www.r-bloggers.com/2012/08/count-data-and-glms-choosing-among-poisson-negative-binomial-and-zero-inflated-models/">Count data and GLMs: choosing among Poisson, negative binomial, and zero-inflated models</a></p>
<p><a href="https://fukamilab.github.io/BIO202/04-C-zero-data.html">GLM with zero-inflated data</a></p>
<p><a href="https://eddatascienceees.github.io/tutorial-zacharyli1/">Zero-inflated Models Using DHARMa and glmmTMB</a></p>
</section>
<section id="other-similar-types-of-data" class="level1">
<h1>Other (similar) types of data</h1>
<p>Sometimes your data might look like Count data, but it really ain’t.</p>
<p>If your data is <em>ranked</em>, for example, a <em>Likert scale</em>, then you should use an <strong>ordinal</strong> regression. R has several implementations for ordinal logistic regressions, such as the function <code>polr</code> from the package <code>MASS</code> or the much more flexible <code>clm</code> from the package <code>ordinal</code>. If you need a mixed-effects ordinal logistic regression (for within-subjects repeated-measures data) then there is the function <code>clmm</code> also from <code>ordinal</code>.</p>
<p>If your data has both <em>lower and upper bounds</em>, then it could potentially be <em>percentage or proportional</em> data, and you should consider a <strong>beta</strong> regression. You can use the function <code>betareg</code> from the same-named package. Note that beta regressions do not accept zeros or ones, so either you need to convert your data to remove the zeros and ones (e.g., see <a href="https://doi.apa.org/doi/10.1037/1082-989X.11.1.54">Smithson &amp; Verkuilen, 2006</a>; <a href="https://doi.org/10.3102/1076998610396895">Verkuilen &amp; Smithson, 2012</a>) or you can use zero-one-inflated-beta regression (ZOIB).</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>A note on statistical diagnostic tests for distributions and regressions: most tests of normality (Shapiro-Wilk, Kolmogorov-Smirnoff) and tests of diagnostics (Levene’s, White’s) are generally not recommended. This is because with large datasets they are over-sensitive and will highlight even tiny deviations (common in real-life due to noise) as significant. With small datasets they are under-powered to identify real deviations. Visual inspection is often best. For more read: https://towardsdatascience.com/stop-testing-for-normality-dba96bb73f90.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>If the count data is far away enough from zero, then it would be more acceptable to either treat it as a normal distribution (if it looks like one), or try to log the data if it is skewed.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Note that a <em>general</em> linear regression is the ordinary type which assumes that the data follows a normal distribution, while a <em>generalized</em> linear regression is a more flexible version that accepts different types of distributions, such as binomial (for logistic regression), or poisson and negative binomial (and many others).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>You might have come across Log-Likelihood (LL) before in logistic regressions, often called <em>deviance</em>, and it is the base to calculate pseudo-<span class="math inline">\(R^2\)</span> measures such as Nagelkerke. LL is great for comparing across model fits, but be careful as certain approaches use different ways to calculate LL which means they might not be directly comparable sometimes.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Don’t ask me why there are three different negative binomial families in glmmTMB (<code>nbinom1</code>, <code>nbinom2</code>, and <code>nbinom12</code>). The difference between them seem minimal - and mostly philosophical about how to define variance. I’m not sure which one is the “best” or why. I often just use the first one and if it throws me an error I try one of the other ones. Also annoyingly, note that different functions call the distributions different names, such as <code>nbinom</code> vs <code>negbinom</code> and <code>poisson</code> vs <code>pois</code>. Always check the help for each function.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>This data is adapted from a real study, but the actual data has been tweaked slightly to simplify this example. In the actual dataset there was no correlation between switch count and PGSI.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>Significant values below 1 with data significantly to the right of the red line would mean a lack of zeros.<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>If your data is repeated measures and you need a mixed effects model, the same function <code>glmmTMB</code> from before allows for zero inflation, all you need to do is specify the zero-inflation component using <code>zi=...</code>, although it can be very slow to fit.<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>Some other functions <strong>require</strong> you to specify a zero-inflated component using some sort of syntax such as <code>zi = ...</code>. Please read the help for the specific function you are using. Even for <code>zeroinfl</code> you can specify separate models for each part, with separate predictors, if you believe that the processes generating outcomes from each component are different.<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>Again be careful when comparing AIC as not all are comparable, but in this case they are. Also if you want to evaluate if the difference in AIC between the two models is significant or not, there are ways of calculating this, but I did not include it here.<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>